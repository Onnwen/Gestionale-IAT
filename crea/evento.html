<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../node_modules/tinymce/tinymce.min.js"></script>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>

    <script>
        tinymce.init({
            selector: '#mytextarea',
            language: 'it',
            plugins: [
                'a11ychecker', 'advlist', 'advcode', 'advtable', 'autolink', 'checklist', 'export',
                'lists', 'link', 'image', 'charmap', 'preview', 'anchor', 'searchreplace', 'visualblocks',
                'powerpaste', 'fullscreen', 'formatpainter', 'insertdatetime', 'media', 'table', 'help', 'wordcount'
            ],
            toolbar: 'undo redo | formatpainter casechange blocks | bold italic backcolor | ' +
                'alignleft aligncenter alignright alignjustify | ' +
                'bullist numlist checklist outdent indent | removeformat | a11ycheck code table help'
        });
    </script>
    <title>Nuovo evento</title>
</head>

<body class="bg-light my-5">
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="../index.php">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="../lista/eventi.html">Eventi</a></li>
            <li class="breadcrumb-item active" aria-current="page">Nuovo</li>
        </ol>
    </nav>

    <h1 class="mt-5 mb-4">Crea evento</h1>
    <main>
        <form class="needs-validation" id="create" novalidate="">
            <div class="row g-3">
                <div class="col-sm-12">
                    <label for="nome" class="form-label">Nome</label>
                    <input type="text" class="form-control" id="nome" placeholder="" value="" required="">
                </div>

                <div class="col-sm-6">
                    <label for="start" class="form-label">Data d'inizio:</label>
                    <input class="form-control" type="date" id="start" name="trip-start"
                           value="2018-07-22"
                           min="2018-01-01" max="2018-12-31">
                </div>

                <div class="col-sm-6">
                    <label for="end" class="form-label">Data di fine:</label>
                    <input class="form-control" type="date" id="end" name="trip-start"
                           value="2018-07-22"
                           min="2018-01-01" max="2018-12-31">
                </div>

                <label for="mytextarea">Descrizione</label><textarea id="mytextarea">Testo descrittivo</textarea>

                <div class="col-sm-12">
                    <label for="immageUrl" class="form-label">URL immagine</label>
                    <input type="text" class="form-control" id="immageUrl" placeholder="" value="" required="">
                </div>

                <div class="col-sm-4">
                    <label for="localityName" class="form-label">Localit√†</label>
                    <input type="text" class="form-control" id="localityName" placeholder="" value="" required="">
                </div>
                <div class="col-md-4">
                    <label for="type" class="form-label">Tipologia</label>
                    <select class="form-select" id="type" required="">
                        <option value="">Seleziona...</option>
                        <option>Concerto</option>
                        <option>Fiera</option>
                        <option>Manifestazione</option>
                        <option>Mercatino</option>
                        <option>Mostra</option>
                        <option>Teatro</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="phone" class="form-label">Telefono</label>
                    <input type="text" class="form-control" id="phone" placeholder="" value="" required="">
                </div>

                <div class="col-sm-6">
                    <label for="longitude" class="form-label">Longitudine</label>
                    <input type="text" class="form-control" id="longitude" placeholder="" value="" required="">
                </div>
                <div class="col-sm-6">
                    <label for="latitude" class="form-label">Latitudine</label>
                    <input type="text" class="form-control" id="latitude" placeholder="" value="" required="">
                </div>

            </div>

            <hr class="my-4">

            <button class="w-100 btn btn-primary mb-2">Conferma</button>
            <a class="w-100 btn btn-secondary" href="../lista/eventi.html">Annulla</a>
        </form>
    </main>
</div>
</body>
<script>
    $("#create").submit(function (e) {
        e.preventDefault();

        let name = document.getElementById("nome").value;
        let start = document.getElementById("start").value;
        let end = document.getElementById("end").value;
        let description = tinymce.get("mytextarea").getContent();
        let imageUrl = document.getElementById("immageUrl").value;
        let locality = document.getElementById("localityName").value;
        let type = document.getElementById("type").value;
        let longitude = document.getElementById("longitude").value;
        let latitude = document.getElementById("latitude").value;
        let telefono = document.getElementById("phone").value;

        let data = {
            "nome": name,
            "data_inizio": start,
            "data_fine": end,
            "descrizione": description,
            "url_immagine": imageUrl,
            "localita": locality,
            "tipologia": type,
            "telefono": telefono,
            "longitudine": longitude,
            "latitudine": latitude
        };

        $.ajax({
            url: "../php/gestisci/evento.php",
            type: "POST",
            data: data
        }).always(function () {
            window.location.replace("../lista/eventi.html");
        })
    });
</script>
</html>
